Marionette.View=Backbone.View.extend({constructor:function(e){_.bindAll(this,"render"),this.options=_.extend({},_.result(this,"options"),_.isFunction(e)?e.call(this):e),this.events=this.normalizeUIKeys(_.result(this,"events")),_.isObject(this.behaviors)&&new Marionette.Behaviors(this),Backbone.View.prototype.constructor.apply(this,arguments),Marionette.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled)},triggerMethod:Marionette.triggerMethod,normalizeMethods:Marionette.normalizeMethods,getTemplate:function(){return Marionette.getOption(this,"template")},mixinTemplateHelpers:function(e){e=e||{};var t=Marionette.getOption(this,"templateHelpers");return _.isFunction(t)&&(t=t.call(this)),_.extend(e,t)},normalizeUIKeys:function(e){var t=_.result(this,"ui");return Marionette.normalizeUIKeys(e,t)},configureTriggers:function(){if(!this.triggers)return;var e={},t=this.normalizeUIKeys(_.result(this,"triggers"));return _.each(t,function(t,n){var r=_.isObject(t),i=r?t.event:t;e[n]=function(e){if(e){var n=e.preventDefault,s=e.stopPropagation,o=r?t.preventDefault:n,u=r?t.stopPropagation:s;o&&n&&n.apply(e),u&&s&&s.apply(e)}var a={view:this,model:this.model,collection:this.collection};this.triggerMethod(i,a)}},this),e},delegateEvents:function(e){this._delegateDOMEvents(e),Marionette.bindEntityEvents(this,this.model,Marionette.getOption(this,"modelEvents")),Marionette.bindEntityEvents(this,this.collection,Marionette.getOption(this,"collectionEvents"))},_delegateDOMEvents:function(e){e=e||this.events,_.isFunction(e)&&(e=e.call(this));var t={},n=_.result(this,"behaviorEvents")||{},r=this.configureTriggers();_.extend(t,n,e,r),Backbone.View.prototype.delegateEvents.call(this,t)},undelegateEvents:function(){var e=Array.prototype.slice.call(arguments);Backbone.View.prototype.undelegateEvents.apply(this,e),Marionette.unbindEntityEvents(this,this.model,Marionette.getOption(this,"modelEvents")),Marionette.unbindEntityEvents(this,this.collection,Marionette.getOption(this,"collectionEvents"))},onShowCalled:function(){},close:function(){if(this.isClosed)return;var e=Array.prototype.slice.call(arguments),t=this.triggerMethod.apply(this,["before:close"].concat(e));if(t===!1)return;this.isClosed=!0,this.triggerMethod.apply(this,["close"].concat(e)),this.unbindUIElements(),this.remove()},bindUIElements:function(){if(!this.ui)return;this._uiBindings||(this._uiBindings=this.ui);var e=_.result(this,"_uiBindings");this.ui={},_.each(_.keys(e),function(t){var n=e[t];this.ui[t]=this.$(n)},this)},unbindUIElements:function(){if(!this.ui||!this._uiBindings)return;_.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings}});